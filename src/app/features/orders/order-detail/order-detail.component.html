<div class="container mt-4 mb-5">
  <!-- Back Button -->
  <div class="mb-3">
    <button class="btn btn-outline-secondary" (click)="goBack()">
      <i class="bi bi-arrow-left me-2"></i>
      {{ isAdmin ? "Back to Admin Panel" : "Back to Orders" }}
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3">Loading order details...</p>
  </div>

  <!-- Error Message -->
  <div
    *ngIf="errorMessage && !isLoading"
    class="alert alert-danger"
    role="alert"
  >
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    {{ errorMessage }}
  </div>

  <!-- Order Detail -->
  <div *ngIf="!isLoading && order" class="row">
    <!-- Left Column - Order Items -->
    <div class="col-lg-8">
      <!-- Order Header -->
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
              <i class="bi bi-receipt me-2"></i>
              Order Details
            </h5>
            <span
              [class]="'badge ' + getStatusBadgeClass(order.status)"
              style="font-size: 1rem"
            >
              {{ getStatusText(order.status) }}
            </span>
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <small class="text-muted">Order ID</small>
              <div class="fw-bold">{{ order.id }}</div>
            </div>
            <div class="col-md-6 mb-3">
              <small class="text-muted">Order Date</small>
              <div class="fw-bold">{{ order.orderDate | date : "full" }}</div>
            </div>
            <div class="col-md-6 mb-3">
              <small class="text-muted">Payment Method</small>
              <div>
                <i
                  [class]="
                    'bi ' + getPaymentMethodIcon(order.paymentMethod) + ' me-2'
                  "
                ></i>
                {{ getPaymentMethodText(order.paymentMethod) }}
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <small class="text-muted">Total Amount</small>
              <div class="h5 text-primary mb-0">
                {{ order.totalAmount | currency }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Order Items -->
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h6 class="mb-0">
            <i class="bi bi-bag-check me-2"></i>
            Order Items
          </h6>
        </div>
        <div class="card-body">
          <div
            *ngIf="!order.orderItems || order.orderItems.length === 0"
            class="text-center text-muted py-3"
          >
            No items in this order
          </div>

          <div *ngIf="order.orderItems && order.orderItems.length > 0">
            <div
              *ngFor="let item of order.orderItems; let last = last"
              class="order-item"
              [class.border-bottom]="!last"
            >
              <div class="row align-items-center">
                <div class="col-md-6">
                  <h6 class="mb-1">{{ item.productName }}</h6>
                  <small class="text-muted"
                    >Product ID: {{ item.productId.substring(0, 8) }}...</small
                  >
                </div>
                <div class="col-md-2 text-center">
                  <small class="text-muted d-block">Quantity</small>
                  <span class="badge bg-secondary">{{ item.quantity }}</span>
                </div>
                <div class="col-md-2 text-center">
                  <small class="text-muted d-block">Unit Price</small>
                  <strong>{{ item.unitPrice | currency }}</strong>
                </div>
                <div class="col-md-2 text-end">
                  <small class="text-muted d-block">Subtotal</small>
                  <strong class="text-primary">{{
                    item.subtotal | currency
                  }}</strong>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column - Shipping & Summary -->
    <div class="col-lg-4">
      <!-- Shipping Information -->
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h6 class="mb-0">
            <i class="bi bi-truck me-2"></i>
            Shipping Address
          </h6>
        </div>
        <div class="card-body">
          <p class="mb-0" style="white-space: pre-line">
            {{ order.shippingAddress }}
          </p>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h6 class="mb-0">
            <i class="bi bi-calculator me-2"></i>
            Order Summary
          </h6>
        </div>
        <div class="card-body">
          <div class="d-flex justify-content-between mb-2">
            <span>Subtotal:</span>
            <strong>{{ order.totalAmount | currency }}</strong>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Shipping:</span>
            <strong class="text-success">FREE</strong>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Tax:</span>
            <strong>{{ 0 | currency }}</strong>
          </div>
          <hr />
          <div class="d-flex justify-content-between">
            <h6 class="mb-0">Total:</h6>
            <h5 class="mb-0 text-primary">
              {{ order.totalAmount | currency }}
            </h5>
          </div>
        </div>
      </div>

      <!-- Order Status Timeline -->
      <div class="card">
        <div class="card-header bg-light">
          <h6 class="mb-0">
            <i class="bi bi-list-check me-2"></i>
            Order Status
          </h6>
        </div>
        <div class="card-body">
          <div class="timeline">
            <div
              class="timeline-item"
              [class.active]="order.status >= OrderStatus.Pending"
            >
              <div class="timeline-marker"></div>
              <div class="timeline-content">
                <strong>Order Placed</strong>
                <small class="text-muted d-block">Order confirmed</small>
              </div>
            </div>
            <div
              class="timeline-item"
              [class.active]="order.status >= OrderStatus.Processing"
            >
              <div class="timeline-marker"></div>
              <div class="timeline-content">
                <strong>Processing</strong>
                <small class="text-muted d-block">Preparing your order</small>
              </div>
            </div>
            <div
              class="timeline-item"
              [class.active]="order.status >= OrderStatus.Shipped"
            >
              <div class="timeline-marker"></div>
              <div class="timeline-content">
                <strong>Shipped</strong>
                <small class="text-muted d-block">On the way</small>
              </div>
            </div>
            <div
              class="timeline-item"
              [class.active]="order.status >= OrderStatus.Completed"
            >
              <div class="timeline-marker"></div>
              <div class="timeline-content">
                <strong>Delivered</strong>
                <small class="text-muted d-block">Order completed</small>
              </div>
            </div>
          </div>

          <!-- Success Message -->
          <div
            *ngIf="order.status === OrderStatus.Completed"
            class="alert alert-success mt-3 mb-0"
          >
            <i class="bi bi-check-circle-fill me-2"></i>
            <strong>Order Completed!</strong>
            <p class="mb-0 mt-1"><small>Thank you for your purchase!</small></p>
          </div>

          <!-- Cancelled Message -->
          <div
            *ngIf="order.status === OrderStatus.Cancelled"
            class="alert alert-danger mt-3 mb-0"
          >
            <i class="bi bi-x-circle-fill me-2"></i>
            <strong>Order Cancelled</strong>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="d-grid gap-2 mt-3">
        <button class="btn btn-primary" (click)="continueShopping()">
          <i class="bi bi-shop me-2"></i>
          Continue Shopping
        </button>
      </div>
    </div>
  </div>
</div>
